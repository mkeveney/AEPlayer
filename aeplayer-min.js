/*!
 * AEPlayer animation library
 #
 * http://github.com/mkeveney/aeplayer
 *
 * Copyright 2012, Matt Keveney
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Includes getElementsByClassName function, Developed by Robert Nyman, http://www.robertnyman.com,
 * Code/licensing: http://code.google.com/p/getelementsbyclassname/
 *
 * March 08 2012 12:01 am PST
 */
(function(){var f,e,c,b,d,a;f={addListener:function(g,i,h){if(g.addEventListener){g.addEventListener(i,h,false)}else{if(g.attachEvent){g.attachEvent("on"+i,h)}}},removeListener:function(g,i,h){if(g.removeEventListener){g.removeEventListener(i,h,false)}else{if(g.detachEvent){g.detachEvent("on"+i,h)}}},getFirstChildWithClass:function(j,l){var k,h,g;k=new RegExp("(^|\\s)"+l+"(\\s|$)");for(g=0;g<j.childNodes.length;g++){h=j.childNodes[g];if(k.test(h.className)){return h}}},getElementsByClassName:function(h,g,i){if(document.getElementsByClassName){this.getElementsByClassName=function(o,r,n){n=n||document;var j=n.getElementsByClassName(o),q=(r)?new RegExp("\\b"+r+"\\b","i"):null,k=[],m,l,p;for(l=0,p=j.length;l<p;l+=1){m=j[l];if(!q||q.test(m.nodeName)){k.push(m)}}return k}}else{if(document.evaluate){this.getElementsByClassName=function(t,w,s){w=w||"*";s=s||document;var m=t.split(" "),u="",q="http://www.w3.org/1999/xhtml",v=(document.documentElement.namespaceURI===q)?q:null,n=[],k,l,o,p;for(o=0,p=m.length;o<p;o+=1){u+="[contains(concat(' ', @class, ' '), ' "+m[o]+" ')]"}try{k=document.evaluate(".//"+w+u,s,v,0,null)}catch(r){k=document.evaluate(".//"+w+u,s,null,0,null)}while(!!(l=k.iterateNext())){n.push(l)}return n}}else{this.getElementsByClassName=function(x,A,w){A=A||"*";w=w||document;var q=x.split(" "),z=[],j=(A==="*"&&w.all)?w.all:w.getElementsByTagName(A),v,s=[],u,r,n,p,y,o,t;for(r=0,n=q.length;r<n;r+=1){z.push(new RegExp("(^|\\s)"+q[r]+"(\\s|$)"))}for(p=0,y=j.length;p<y;p+=1){v=j[p];u=false;for(o=0,t=z.length;o<t;o+=1){u=z[o].test(v.className);if(!u){break}}if(u){s.push(v)}}return s}}}return this.getElementsByClassName(h,g,i)}};e=function(j){var i,l,p,r,k,h,u,q,o,t,n,m,s,g;o=function(w){var x,v;x=v=0;if(w.offsetParent){x=w.offsetLeft;v=w.offsetTop;while(!!(w=w.offsetParent)){x+=w.offsetLeft;v+=w.offsetTop}}return[x,v]};t=function(w){if(w<l){return l}if(w>p){return p}w=Math.floor(w+0.5);return w};n=function(){var v=((r-l)*u/(p-l));i.style.left=v+"px"};m=function(w){w=w||window.event;if(w.preventDefault){w.preventDefault()}var v=w.clientX-q.x;v+=q.k;v=(v<0)?0:v;v=(v>u)?u:v;i.style.left=v+"px";v=l+(v*(p-l)/u);v=Math.floor(v+0.5);if(v!==r){r=v;if(k){k(v)}}return false};s=function(){f.removeListener(document,"mouseup",s);f.removeListener(document,"mousemove",m);n();return false};g=function(w){w=w||window.event;if(w.preventDefault){w.preventDefault()}var v=parseInt(i.style.left,10);q={x:w.clientX,k:v};f.addListener(document,"mouseup",s);f.addListener(document,"mousemove",m);return false};i=f.getFirstChildWithClass(j,"knob");l=0;p=100;r=0;h=o(j)[0];u=j.clientWidth-i.clientWidth;i.style.position="relative";n();f.addListener(i,"mousedown",g);return{setValue:function(v){r=t(v);n();return this},getValue:function(){return r},setMin:function(v){l=v;return this},setMax:function(v){p=v;return this},setListener:function(v){k=v;return this}}};c=function(i,o){var j,p,l,k,m,h,n,g;m=function(){if(j){o()}else{j=true;window.clearInterval(p);p=window.setInterval(m,k)}};h=function(){j=false;o();p=window.setInterval(m,l)};n=function(){window.clearInterval(p)};g=function(q){q=q||window.event;if(q.keyCode===32){o()}};l=750;k=75;f.addListener(i,"mousedown",h);f.addListener(i,"mouseup",n);f.addListener(i,"mouseout",n);f.addListener(i,"keydown",g);return{setInitDelay:function(q){l=q;return this},setRepeatDelay:function(q){k=q;return this}}};b=function(n){var p,r,g,h,o,u,j,s,k,t,q,m,l;s=function(){var x,w,v;g=(g+h)%h;w=0;for(x=0;x<t.length;x++){if(g>=t[x].iframe){w=x}}v=g-t[w].iframe;if(l!=w){n.style.backgroundImage=t[w].img;l=w}n.style.backgroundPosition="0px -"+v*j+"px"};k=function(){g+=1;s()};p=false;u=0;r=10;g=0;h=16;l=-1;t=[];o=/\baepframes_(\d+)\b/.exec(n.className);if(o){h=parseInt(o[1],10)}t.push({iframe:0,img:n.style.backgroundImage});q=f.getElementsByClassName("aeplayer_ext","div",n);for(m=0;m<q.length;m++){o=/\aepinitframe_(\d+)\b/.exec(q[m].className);if(o){t.push({iframe:parseInt(o[1],10),img:q[m].style.backgroundImage})}}j=n.clientHeight;return{play:function(){if(!p){if(u){window.clearInterval(u)}u=window.setInterval(k,1000/r);p=true}return this},pause:function(){if(p){window.clearInterval(u);u=0;p=false}return this},isPaused:function(){return !p},setFrame:function(i){if(!p){g=i;s()}return this},getFrame:function(){return g},setRate:function(i){r=i;if(p){this.pause();this.play()}return this},getRate:function(){return r},setFrameCount:function(i){h=i;return this},getFrameCount:function(){return h},getPlayerDiv:function(){return n}}};d=function(h){var g=document.getElementById(h);if(!g){return null}return b(g)};a=function(y,v){var p,h,C,D,w,t,x,n,s,m,q,r,g,i,z,l,j,u,A,B,k,o;k=function(){if(w){if(y.isPaused()){w.innerHTML=B.replace("%d",y.getFrame())}else{w.innerHTML=A.replace("%d",y.getRate())}}};o=function(){if(h){if(y.isPaused()){h.className="playpause play";h.innerHTML=j}else{h.className="playpause pause";h.innerHTML=u}}};q=function(){k();o()};r=function(E){if(y.isPaused()){y.setFrame(E)}else{y.setRate(E)}q()};g=function(){if(y.isPaused()){if(x){x.setMin(n).setMax(s).setValue(y.getRate())}y.play()}else{y.pause();if(x){x.setMin(0).setMax(y.getFrameCount()-1).setValue(y.getFrame())}}q()};i=function(E){if(y.isPaused()){y.setFrame(y.getFrame()+E);if(x){x.setValue(y.getFrame())}}else{var F=y.getRate()+E*m;if(F<n){F=n}if(F>s){F=s}y.setRate(F);if(x){x.setValue(F)}}q()};z=function(){i(1)};l=function(){i(-1)};n=1;s=25;m=1;j="";u="";A="Speed %d fps";B="Frame %d";if(!y){return null}if(v){p=document.getElementById(v);if(!p){return null}}else{p=document.createElement("div");p.className="aep_panel";p.innerHTML="<button class='playpause pause'></button><button class='prev'></button><div class='slider'><div class='knob'></div></div><button class='next'></button><span class='slabel'>Speed: xx fps</span>";if(y.getPlayerDiv().nextSibling){y.getPlayerDiv().parentNode.insertBefore(p,y.getPlayerDiv().nextSibling)}else{y.getPlayerDiv().parentNode.appendChild(p)}}h=f.getFirstChildWithClass(p,"playpause");C=f.getFirstChildWithClass(p,"prev");D=f.getFirstChildWithClass(p,"next");t=f.getFirstChildWithClass(p,"slider");w=f.getFirstChildWithClass(p,"slabel");if(h){f.addListener(h,"click",g)}if(C){c(C,l)}if(D){c(D,z)}if(t){x=e(t).setListener(r);if(y.isPaused()){x.setMin(0).setMax(y.getFrameCount()-1).setValue(y.getFrame())}else{x.setMin(n).setMax(s).setValue(y.getRate())}}q();return{setMinRate:function(E){n=E;if(x){x.setMin(E)}return this},setMaxRate:function(E){s=E;if(x){x.setMax(E)}return this},setRateInc:function(E){m=E;return this},setButtonText:function(E){var F=E.split(";");j=F[0];u=F[1];o();return this},setLabelText:function(E){var F=E.split(";");A=F[0];B=F[1];k();return this}}};f.addListener(window,"load",function(){var h,g;h=f.getElementsByClassName("aeplayer","div");for(g=0;g<h.length;g++){a(b(h[g]).play())}})}());